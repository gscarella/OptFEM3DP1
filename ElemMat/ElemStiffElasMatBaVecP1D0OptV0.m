function [Kg]=ElemStiffElasMatBaVecP1D0OptV0(q,me,volumes,lambda,mu)
%----------------------------------------
% Automatic generation with sage
% (c) Cuvelier F. email:cuvelier@math.univ-paris13.fr
%
% Copyright (C) 2013  CJS (LAGA)
%   see README for details
order=1;
ndf=(order+1)*(order+2)/2;
dim=2*ndf;
ndf2=dim*dim;
G=ComputeGradientVec(q,me);
coef=6*sqrt(volumes);
for il=1:4,for i=1:3, G{il}(i,:)=G{il}(i,:)./coef;end, end
Kg=zeros(ndf2,size(me,2));

T1=G{1}(1,:).^2;
T2=G{1}(2,:).^2;
T3=G{1}(3,:).^2;
C=mu*(T1+ T2 + T3);
Kg(1,:) =(lambda + mu)*T1 + C;
Kg(14,:)=(lambda + mu)*T2 + C;
Kg(27,:)=(lambda + mu)*T3 + C;

T1=G{2}(1,:).^2;
T2=G{2}(2,:).^2;
T3=G{2}(3,:).^2;
C=mu*(T1+ T2 + T3);
Kg(40,:)=(lambda + mu)*T1 + C;
Kg(53,:)=(lambda + mu)*T2 + C;
Kg(66,:)=(lambda + mu)*T3 + C;

T1=G{3}(1,:).^2;
T2=G{3}(2,:).^2;
T3=G{3}(3,:).^2;
C=mu*(T1+ T2 + T3);
Kg(79,:)=(lambda + mu)*T1 + C;%Kg(79,:)=(lambda + 2.*mu).*G{3}(1,:).^2 + mu.*G{3}(2,:).^2 + mu.*G{3}(3,:).^2;
Kg(92,:)=(lambda + mu)*T2 + C;%Kg(92,:)=(lambda + 2.*mu).*G{3}(2,:).^2 + mu.*G{3}(1,:).^2 + mu.*G{3}(3,:).^2;
Kg(105,:)=(lambda + mu)*T3 + C;%Kg(105,:)=(lambda + 2.*mu).*G{3}(3,:).^2 + mu.*G{3}(1,:).^2 + mu.*G{3}(2,:).^2;

T1=G{4}(1,:).^2;
T2=G{4}(2,:).^2;
T3=G{4}(3,:).^2;
C=mu*(T1+ T2 + T3);
Kg(118,:)=(lambda + mu)*T1 + C;%(lambda + 2.*mu).*G{4}(1,:).^2 + mu.*G{4}(2,:).^2 + mu.*G{4}(3,:).^2;
Kg(131,:)=(lambda + mu)*T2 + C;%(lambda + 2.*mu).*G{4}(2,:).^2 + mu.*G{4}(1,:).^2 + mu.*G{4}(3,:).^2;
Kg(144,:)=(lambda + mu)*T3 + C;%(lambda + 2.*mu).*G{4}(3,:).^2 + mu.*G{4}(1,:).^2 + mu.*G{4}(2,:).^2;


Kg(2,:)=(lambda+mu)*G{1}(1,:).*G{1}(2,:);%lambda.*G{1}(1,:).*G{1}(2,:) + mu.*G{1}(1,:).*G{1}(2,:);
Kg(3,:)=(lambda+mu)*G{1}(1,:).*G{1}(3,:); %lambda.*G{1}(1,:).*G{1}(3,:) + mu.*G{1}(1,:).*G{1}(3,:);

T1=G{1}(1,:).*G{2}(1,:);
T2=G{1}(2,:).*G{2}(2,:);
T3=G{1}(3,:).*G{2}(3,:);
C=mu*(T1+ T2 + T3);
Kg(4,:) =(lambda + mu)*T1 + C;%(lambda + 2.*mu).*G{1}(1,:).*G{2}(1,:) + mu.*G{1}(2,:).*G{2}(2,:) + mu.*G{1}(3,:).*G{2}(3,:);
Kg(17,:)=(lambda + mu)*T2 + C;%(lambda + 2.*mu).*G{1}(2,:).*G{2}(2,:) + mu.*G{1}(1,:).*G{2}(1,:) + mu.*G{1}(3,:).*G{2}(3,:);
Kg(30,:)=(lambda + mu)*T3 + C;;%(lambda + 2.*mu).*G{1}(3,:).*G{2}(3,:) + mu.*G{1}(1,:).*G{2}(1,:) + mu.*G{1}(2,:).*G{2}(2,:);

T1=G{1}(1,:).*G{2}(2,:);
T2=G{1}(2,:).*G{2}(1,:);
Kg(5,:) =lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{2}(2,:) + mu.*G{1}(2,:).*G{2}(1,:);
Kg(16,:)=lambda*T2+mu*T1; %lambda.*G{1}(2,:).*G{2}(1,:) + mu.*G{1}(1,:).*G{2}(2,:);

T1=G{1}(1,:).*G{2}(3,:);
T2=G{1}(3,:).*G{2}(1,:);
Kg(6,:) =lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{2}(3,:) + mu.*G{1}(3,:).*G{2}(1,:);
Kg(28,:)=lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{2}(1,:) + mu.*G{1}(1,:).*G{2}(3,:);

T1=G{1}(1,:).*G{3}(1,:);
T2=G{1}(2,:).*G{3}(2,:);
T3=G{1}(3,:).*G{3}(3,:);
C=mu*(T1+ T2 + T3);
Kg(7,:) =(lambda + mu)*T1 + C; %(lambda + 2.*mu).*G{1}(1,:).*G{3}(1,:) + mu.*G{1}(2,:).*G{3}(2,:) + mu.*G{1}(3,:).*G{3}(3,:);
Kg(20,:)=(lambda + mu)*T2 + C; %(lambda + 2.*mu).*G{1}(2,:).*G{3}(2,:) + mu.*G{1}(1,:).*G{3}(1,:) + mu.*G{1}(3,:).*G{3}(3,:);
Kg(33,:)=(lambda + mu)*T3 + C; %(lambda + 2.*mu).*G{1}(3,:).*G{3}(3,:) + mu.*G{1}(1,:).*G{3}(1,:) + mu.*G{1}(2,:).*G{3}(2,:);

T1=G{1}(1,:).*G{3}(2,:);
T2=G{1}(2,:).*G{3}(1,:);
Kg(8,:) = lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{3}(2,:) + mu.*G{1}(2,:).*G{3}(1,:);
Kg(19,:)= lambda*T2+mu*T1; %lambda.*G{1}(2,:).*G{3}(1,:) + mu.*G{1}(1,:).*G{3}(2,:);

T1=G{1}(1,:).*G{3}(3,:);
T2=G{1}(3,:).*G{3}(1,:);
Kg(9,:) = lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{3}(3,:) + mu.*G{1}(3,:).*G{3}(1,:);
Kg(31,:)= lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{3}(1,:) + mu.*G{1}(1,:).*G{3}(3,:);

T1=G{1}(1,:).*G{4}(1,:);
T2=G{1}(2,:).*G{4}(2,:);
T3=G{1}(3,:).*G{4}(3,:);
C=mu*(T1+ T2 + T3);
Kg(10,:)=(lambda + mu)*T1 + C; %(lambda + 2.*mu).*G{1}(1,:).*G{4}(1,:) + mu.*G{1}(2,:).*G{4}(2,:) + mu.*G{1}(3,:).*G{4}(3,:);
Kg(23,:)=(lambda + mu)*T2 + C; %(lambda + 2.*mu).*G{1}(2,:).*G{4}(2,:) + mu.*G{1}(1,:).*G{4}(1,:) + mu.*G{1}(3,:).*G{4}(3,:);
Kg(36,:)=(lambda + mu)*T3 + C; %(lambda + 2.*mu).*G{1}(3,:).*G{4}(3,:) + mu.*G{1}(1,:).*G{4}(1,:) + mu.*G{1}(2,:).*G{4}(2,:);

T1=G{1}(1,:).*G{4}(2,:);
T2=G{1}(2,:).*G{4}(1,:);
Kg(11,:)= lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{4}(2,:) + mu.*G{1}(2,:).*G{4}(1,:);
Kg(22,:)= lambda*T2+mu*T1; %lambda.*G{1}(2,:).*G{4}(1,:) + mu.*G{1}(1,:).*G{4}(2,:);

T1=G{1}(1,:).*G{4}(3,:);
T2=G{1}(3,:).*G{4}(1,:);
Kg(12,:)= lambda*T1+mu*T2; %lambda.*G{1}(1,:).*G{4}(3,:) + mu.*G{1}(3,:).*G{4}(1,:);
Kg(34,:)= lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{4}(1,:) + mu.*G{1}(1,:).*G{4}(3,:);

Kg(15,:)=(lambda+mu)*G{1}(2,:).*G{1}(3,:);%lambda.*G{1}(2,:).*G{1}(3,:) + mu.*G{1}(2,:).*G{1}(3,:);

T1=G{1}(2,:).*G{2}(3,:);
T2=G{1}(3,:).*G{2}(2,:);
Kg(18,:)= lambda*T1+mu*T2; %lambda.*G{1}(2,:).*G{2}(3,:) + mu.*G{1}(3,:).*G{2}(2,:);
Kg(29,:)= lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{2}(2,:) + mu.*G{1}(2,:).*G{2}(3,:);

T1=G{1}(2,:).*G{3}(3,:);
T2=G{1}(3,:).*G{3}(2,:);
Kg(21,:)= lambda*T1+mu*T2; %lambda.*G{1}(2,:).*G{3}(3,:) + mu.*G{1}(3,:).*G{3}(2,:);
Kg(32,:)= lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{3}(2,:) + mu.*G{1}(2,:).*G{3}(3,:);

T1=G{1}(2,:).*G{4}(3,:);
T2=G{1}(3,:).*G{4}(2,:);
Kg(24,:)= lambda*T1+mu*T2; %lambda.*G{1}(2,:).*G{4}(3,:) + mu.*G{1}(3,:).*G{4}(2,:);
Kg(35,:)= lambda*T2+mu*T1; %lambda.*G{1}(3,:).*G{4}(2,:) + mu.*G{1}(2,:).*G{4}(3,:);


Kg(41,:)= (lambda+mu)*G{2}(1,:).*G{2}(2,:); %lambda.*G{2}(1,:).*G{2}(2,:) + mu.*G{2}(1,:).*G{2}(2,:);
Kg(42,:)= (lambda+mu)*G{2}(1,:).*G{2}(3,:); %lambda.*G{2}(1,:).*G{2}(3,:) + mu.*G{2}(1,:).*G{2}(3,:);

T1=G{2}(1,:).*G{3}(1,:);
T2=G{2}(2,:).*G{3}(2,:);
T3=G{2}(3,:).*G{3}(3,:);
C=mu*(T1+ T2 + T3);
Kg(43,:)=(lambda + mu)*T1 + C; % (lambda + 2.*mu).*G{2}(1,:).*G{3}(1,:) + mu.*G{2}(2,:).*G{3}(2,:) + mu.*G{2}(3,:).*G{3}(3,:);
Kg(56,:)=(lambda + mu)*T2 + C; % (lambda + 2.*mu).*G{2}(2,:).*G{3}(2,:) + mu.*G{2}(1,:).*G{3}(1,:) + mu.*G{2}(3,:).*G{3}(3,:);
Kg(69,:)=(lambda + mu)*T3 + C; % (lambda + 2.*mu).*G{2}(3,:).*G{3}(3,:) + mu.*G{2}(1,:).*G{3}(1,:) + mu.*G{2}(2,:).*G{3}(2,:);

T1=G{2}(1,:).*G{3}(2,:);
T2=G{2}(2,:).*G{3}(1,:);
Kg(44,:)= lambda*T1+mu*T2; %lambda.*G{2}(1,:).*G{3}(2,:) + mu.*G{2}(2,:).*G{3}(1,:);
Kg(55,:)= lambda*T2+mu*T1; %lambda.*G{2}(2,:).*G{3}(1,:) + mu.*G{2}(1,:).*G{3}(2,:);

T1=G{2}(1,:).*G{3}(3,:);
T2=G{2}(3,:).*G{3}(1,:);
Kg(45,:)= lambda*T1+mu*T2; %lambda.*G{2}(1,:).*G{3}(3,:) + mu.*G{2}(3,:).*G{3}(1,:);
Kg(67,:)= lambda*T2+mu*T1; %lambda.*G{2}(3,:).*G{3}(1,:) + mu.*G{2}(1,:).*G{3}(3,:);

T1=G{2}(1,:).*G{4}(1,:);
T2=G{2}(2,:).*G{4}(2,:);
T3=G{2}(3,:).*G{4}(3,:);
C=mu*(T1+ T2 + T3);
Kg(46,:)=(lambda + mu)*T1 + C; % (lambda + 2.*mu).*G{2}(1,:).*G{4}(1,:) + mu.*G{2}(2,:).*G{4}(2,:) + mu.*G{2}(3,:).*G{4}(3,:);
Kg(59,:)=(lambda + mu)*T2 + C; % (lambda + 2.*mu).*G{2}(2,:).*G{4}(2,:) + mu.*G{2}(1,:).*G{4}(1,:) + mu.*G{2}(3,:).*G{4}(3,:);
Kg(72,:)=(lambda + mu)*T3 + C; % (lambda + 2.*mu).*G{2}(3,:).*G{4}(3,:) + mu.*G{2}(1,:).*G{4}(1,:) + mu.*G{2}(2,:).*G{4}(2,:);

T1=G{2}(1,:).*G{4}(2,:);
T2=G{2}(2,:).*G{4}(1,:);
Kg(47,:)= lambda*T1+mu*T2; %lambda.*G{2}(1,:).*G{4}(2,:) + mu.*G{2}(2,:).*G{4}(1,:);
Kg(58,:)= lambda*T2+mu*T1; %lambda.*G{2}(2,:).*G{4}(1,:) + mu.*G{2}(1,:).*G{4}(2,:);

T1=G{2}(1,:).*G{4}(3,:);
T2=G{2}(3,:).*G{4}(1,:);
Kg(48,:)= lambda*T1+mu*T2; %lambda.*G{2}(1,:).*G{4}(3,:) + mu.*G{2}(3,:).*G{4}(1,:);
Kg(70,:)= lambda*T2+mu*T1; %lambda.*G{2}(3,:).*G{4}(1,:) + mu.*G{2}(1,:).*G{4}(3,:);

Kg(54,:)= (lambda+mu)*G{2}(2,:).*G{2}(3,:) ;%lambda*G{2}(2,:).*G{2}(3,:) + mu*G{2}(2,:).*G{2}(3,:);

T1=G{2}(2,:).*G{3}(3,:);
T2=G{2}(3,:).*G{3}(2,:);
Kg(57,:)= lambda*T1+mu*T2; %lambda.*G{2}(2,:).*G{3}(3,:) + mu.*G{2}(3,:).*G{3}(2,:);
Kg(68,:)= lambda*T2+mu*T1; %lambda.*G{2}(3,:).*G{3}(2,:) + mu.*G{2}(2,:).*G{3}(3,:);

T1=G{2}(2,:).*G{4}(3,:);
T2=G{2}(3,:).*G{4}(2,:);
Kg(60,:)= lambda*T1+mu*T2; %lambda.*G{2}(2,:).*G{4}(3,:) + mu.*G{2}(3,:).*G{4}(2,:);
Kg(71,:)= lambda*T2+mu*T1; %lambda.*G{2}(3,:).*G{4}(2,:) + mu.*G{2}(2,:).*G{4}(3,:);


Kg(80,:)=(lambda+mu)*G{3}(1,:).*G{3}(2,:);%lambda.*G{3}(1,:).*G{3}(2,:) + mu.*G{3}(1,:).*G{3}(2,:);

Kg(81,:)=(lambda+mu)*G{3}(1,:).*G{3}(3,:);%lambda.*G{3}(1,:).*G{3}(3,:) + mu.*G{3}(1,:).*G{3}(3,:);

T1=G{3}(1,:).*G{4}(1,:);
T2=G{3}(2,:).*G{4}(2,:);
T3=G{3}(3,:).*G{4}(3,:);
C=mu*(T1+ T2 + T3);
Kg(82,:) =(lambda + mu)*T1 + C; % (lambda + 2.*mu).*G{3}(1,:).*G{4}(1,:) + mu.*G{3}(2,:).*G{4}(2,:) + mu.*G{3}(3,:).*G{4}(3,:);
Kg(95,:) =(lambda + mu)*T2 + C; % (lambda + 2.*mu).*G{3}(2,:).*G{4}(2,:) + mu.*G{3}(1,:).*G{4}(1,:) + mu.*G{3}(3,:).*G{4}(3,:);
Kg(108,:)=(lambda + mu)*T3 + C; % (lambda + 2.*mu).*G{3}(3,:).*G{4}(3,:) + mu.*G{3}(1,:).*G{4}(1,:) + mu.*G{3}(2,:).*G{4}(2,:);

T1=G{3}(1,:).*G{4}(2,:);
T2=G{3}(2,:).*G{4}(1,:);
Kg(83,:)= lambda*T1+mu*T2; %lambda.*G{3}(1,:).*G{4}(2,:) + mu.*G{3}(2,:).*G{4}(1,:);
Kg(94,:)= lambda*T2+mu*T1; %lambda.*G{3}(2,:).*G{4}(1,:) + mu.*G{3}(1,:).*G{4}(2,:);

T1=G{3}(1,:).*G{4}(3,:);
T2=G{3}(3,:).*G{4}(1,:);
Kg(84,:) = lambda*T1+mu*T2; %lambda.*G{3}(1,:).*G{4}(3,:) + mu.*G{3}(3,:).*G{4}(1,:);
Kg(106,:)= lambda*T2+mu*T1; %lambda.*G{3}(3,:).*G{4}(1,:) + mu.*G{3}(1,:).*G{4}(3,:);


Kg(93,:)=(lambda+mu)*G{3}(2,:).*G{3}(3,:);%lambda.*G{3}(2,:).*G{3}(3,:) + mu.*G{3}(2,:).*G{3}(3,:);

T1=G{3}(2,:).*G{4}(3,:);
T2=G{3}(3,:).*G{4}(2,:);
Kg(96,:) = lambda*T1+mu*T2; %lambda.*G{3}(2,:).*G{4}(3,:) + mu.*G{3}(3,:).*G{4}(2,:);
Kg(107,:)= lambda*T2+mu*T1; %lambda.*G{3}(3,:).*G{4}(2,:) + mu.*G{3}(2,:).*G{4}(3,:);


Kg(119,:)=(lambda + mu)*G{4}(1,:).*G{4}(2,:);% lambda.*G{4}(1,:).*G{4}(2,:) + mu.*G{4}(1,:).*G{4}(2,:);
Kg(120,:)=(lambda + mu)*G{4}(1,:).*G{4}(3,:);% lambda.*G{4}(1,:).*G{4}(3,:) + mu.*G{4}(1,:).*G{4}(3,:);
Kg(132,:)=(lambda + mu)*G{4}(2,:).*G{4}(3,:);% lambda.*G{4}(2,:).*G{4}(3,:) + mu.*G{4}(2,:).*G{4}(3,:);

Kg([13, 25, 26, 37, 38, 39, 49, 50, 51, 52, 61, 62, 63, 64, 65, 73, 74, 75, 76, 77, 78, 85, 86, 87, 88, 89, 90, 91, 97, 98, 99, 100, 101, 102, 103, 104, 109, 110, 111, 112, 113, 114, 115, 116, 117, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143],:)=Kg([2, 3, 15, 4, 16, 28, 5, 17, 29, 41, 6, 18, 30, 42, 54, 7, 19, 31, 43, 55, 67, 8, 20, 32, 44, 56, 68, 80, 9, 21, 33, 45, 57, 69, 81, 93, 10, 22, 34, 46, 58, 70, 82, 94, 106, 11, 23, 35, 47, 59, 71, 83, 95, 107, 119, 12, 24, 36, 48, 60, 72, 84, 96, 108, 120, 132],:);
